## JPQL
: Java Persistence Query Language

JPA는 JPQL, QueryDSL등과 같은 다양한 쿼리 방법을 지원한다.

JPA를 사용하면 엔티티 객체를 중심으로 개발하는데 이때 검색 쿼리시 문제가 될 수 있다.  
JPQL은 테이블이 아닌 엔티티 객체를 대상으로 검색하기 때문에 가능하다.

> JPQL과 SQL의 가장 큰 차이점으로 SQL은 데이터베이스 테이블을 대상으로 쿼리한다.  
> (하지만 JPQL도 결국 방언과 조합되어 SQL로 변환된다.)

JPQL은 SQL을 추상화하여 특정 데이터베이스 SQL에 의존하지 않는나는 장점이 있다.  
(JPQL은 객체지향 SQL)

### JPQL 문법
엔티티와 속성은 대소문자를 구분하지만 JPQL 키워드는 대소문자를 구분하지 않는다.

그리고 테이블 이름 대신 엔티티 이름을 사용한다.

또한 as는 생략 가능하되 별칭은 필수로 붙여주어야 한다.  
(Ex. Member m)

> - **TypeQuery**  
> : 반환 타입이 명확할 때 사용
> - **Query**  
> : 반환 타입이 명확하지 않을 때 사용

> - **query.getResultList()**  
> : 결과가 **하나 이상일 때** 리스트를 반환한다. 결과가 없을 경우 빈 리스트를 반환한다.
> - **query.getSingleResult()**  
> : 결과가 **딱 하나일 때**, 단일 객체를 반환한다. 결과가 없거나 둘 이상이라면 예외를 발생시킨다.

그리고 JPQL은 파라미터 바인딩을 지원하는데 이는 이름, 위치를 기준으로 한다.

주의해야 할 것은 ENUM 타입을 사용할 때 자바 패키지명을 모두 포함하여 기재해야한다는 것이다.  
(Ex. book.MemberType.Admin)

JPQL의 한계는 FROM 절에서 서브쿼리를 사용할 수 없다는 것이다.  
조인으로 풀 수 있으면 풀어서 해결해야 한다.

### JPQL fetch join, 페치조인
: 연관된 엔티티나 컬렉션을 SQL 한 번에 함께 조회할 수 있는 기능이다.

페치조인은 SQL조인 종류가 아니다.  
이는 JPQL에서 **성능 최적화**를 위해 제공하는 기능이다.

join fetch 명령어로 사용한다.

> **페치 조인과 일반 조인**  
> 페치 조인을 사용할 때만 연관된 엔티티도 함께 조회(**즉시 로딩**)된다.  
> (사실상 즉시 로딩이 발생하는 것으로 지연로딩을 지정해주어도 페치조인을 사용한다면 페치 조인이 우선시되어 즉시로딩된다.)  
> 페치 조인은 객체 그래프를 SQL 한 번에 조회하는 개념이다.
